I've updated your expense tracking app to include a new feature that displays random, quirky quotes about finance and movies. I've replaced the "AI Financial Assistant" section with this new "Daily Dose of Wisdom" functionality. I've also changed the button to "Get a Quote" and re-purposed the existing AI Insight box to display the quotes. This version avoids the API call which may have been causing issues on GitHub Pages by using a local array of quotes.

Here is the full, updated HTML file with these changes. You can copy and paste this into your project.

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Āvarta: Finance Flow</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Poppins', 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        .recurring-toggle-switch {
            width: 3.5rem;
            height: 2rem;
            position: relative;
            cursor: pointer;
        }
        .recurring-toggle-switch input {
            display: none;
        }
        .recurring-toggle-switch .slider {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #334155;
            transition: .4s;
            border-radius: 9999px;
        }
        .recurring-toggle-switch .slider:before {
            position: absolute;
            content: "";
            height: 1.5rem;
            width: 1.5rem;
            left: 4px;
            bottom: 4px;
            background-color: #f1f5f9;
            transition: .4s;
            border-radius: 9999px;
        }
        .recurring-toggle-switch input:checked + .slider {
            background-color: #eab308;
        }
        .recurring-toggle-switch input:checked + .slider:before {
            transform: translateX(1.5rem);
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-200 antialiased">

    <div class="container mx-auto max-w-4xl p-4 md:p-8">
        <!-- Message Modal -->
        <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50 p-4">
            <div class="bg-slate-800 p-6 rounded-xl shadow-lg text-center max-w-sm w-full border border-amber-500">
                <p id="message-text" class="text-slate-100 text-lg mb-4"></p>
                <button id="message-ok-btn" class="bg-amber-500 text-slate-900 font-bold py-2 px-6 rounded-full hover:bg-amber-600 transition-colors shadow-md">
                    OK
                </button>
            </div>
        </div>

        <!-- Activity Log Modal -->
        <div id="log-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50 p-4">
            <div class="bg-slate-800 p-6 rounded-xl shadow-lg max-w-lg w-full max-h-[80vh] flex flex-col border border-amber-500">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-slate-100">Activity Log</h2>
                    <button id="log-modal-close-btn" class="text-slate-400 hover:text-slate-200">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x-circle"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
                    </button>
                </div>
                <div id="log-entries" class="overflow-y-auto space-y-4 flex-1 custom-scrollbar">
                    <!-- Log entries will be inserted here by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Export Modal -->
        <div id="export-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50 p-4">
            <div class="bg-slate-800 p-6 rounded-xl shadow-lg max-w-sm w-full text-center border border-amber-500">
                <h3 class="text-xl font-bold mb-4">Export Options</h3>
                <div class="space-y-4">
                    <button id="download-csv-btn" class="w-full bg-amber-500 text-slate-900 font-bold py-3 px-6 rounded-lg hover:bg-amber-600 transition-colors shadow-md flex items-center justify-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                        <span>Download as CSV</span>
                    </button>
                    <button id="email-csv-btn" class="w-full bg-slate-700 text-slate-300 font-bold py-3 px-6 rounded-lg hover:bg-slate-600 transition-colors shadow-md flex items-center justify-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail-check"><path d="M22 10V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h11"/><path d="m22 10-7.22 5.07a1.5 1.5 0 0 1-1.97 0L2 6"/><path d="m16 19 2 2 4-4"/></svg>
                        <span>Email CSV</span>
                    </button>
                </div>
                <button id="export-modal-close-btn" class="mt-6 text-slate-400 hover:text-slate-200">
                    Close
                </button>
            </div>
        </div>

        <!-- Header Section -->
        <header class="flex items-center justify-between p-4 md:p-6 bg-slate-800 rounded-xl shadow-lg mb-8 border border-slate-700">
            <div class="flex items-center space-x-4">
                <svg width="60" height="60" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" class="fill-current text-amber-500">
                    <path d="M 50,20 A 30,30 0 0,1 50,80 A 30,30 0 0,1 50,20 Z" fill="none" stroke="#eab308" stroke-width="8" />
                    <path d="M 50,20 Q 70,30 65,50 C 60,70 50,80 50,80" fill="none" stroke="#fcd34d" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" />
                    <circle cx="50" cy="50" r="10" fill="#fef08a"/>
                </svg>
                <div class="flex flex-col">
                    <h1 class="text-3xl font-extrabold tracking-tight text-slate-100">Āvarta</h1>
                    <div class="flex items-center space-x-2 mt-1 text-sm text-slate-400">
                        <span class="font-medium">Finance Flow</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-text text-amber-500"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/><path d="M8 7h6"/><path d="M8 11h8"/></svg>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-hourglass text-amber-500"><path d="M5 22h14"/><path d="M5 2h14"/><path d="M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22"/><path d="M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2"/></svg>
                    </div>
                </div>
            </div>
            <button id="show-log-btn" class="bg-slate-700 text-amber-500 p-2 rounded-full shadow-md hover:bg-slate-600 transition-colors" title="View Activity Log">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-scroll-text"><path d="M21 10c0 7-7 9-7 9s-7-2-7-9l7-10z"/><path d="M12 12h4"/><path d="M12 8h4"/></svg>
            </button>
        </header>

        <!-- Main Content -->
        <main class="space-y-8">
            <!-- Username Section -->
            <div class="bg-slate-800 p-6 rounded-xl shadow-md border border-slate-700">
                <h2 class="text-xl font-bold mb-4 flex items-center space-x-2 text-slate-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user text-amber-500"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    <span>Set Your Username</span>
                </h2>
                <div class="flex flex-col space-y-4 md:space-y-0 md:flex-row md:items-center md:space-x-4">
                    <input type="text" id="username-input" placeholder="Enter 8-12 character username" class="w-full md:w-auto flex-1 p-3 border border-slate-700 bg-slate-900 text-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" />
                    <button id="suggest-name-btn" class="bg-slate-700 text-slate-200 px-6 py-3 rounded-lg font-medium shadow-md hover:bg-slate-600 transition-colors">
                        Suggest Name
                    </button>
                    <button id="set-username-btn" class="bg-amber-500 text-slate-900 px-6 py-3 rounded-lg font-bold shadow-md hover:bg-amber-600 transition-colors">
                        Set Username
                    </button>
                </div>
                <p id="current-username" class="mt-4 text-lg font-semibold text-slate-200 hidden">
                    Current Username: <span id="username-display" class="text-amber-500"></span>
                </p>
                <p id="user-id-display" class="mt-2 text-xs font-mono text-slate-400 truncate hidden"></p>
            </div>

            <!-- AI Financial Assistant Section -->
            <!-- Updated to be a "Daily Dose of Wisdom" with random quotes -->
            <div class="bg-slate-800 p-6 rounded-xl shadow-md border border-slate-700">
                <h2 class="text-xl font-bold mb-4 flex items-center space-x-2 text-slate-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lightbulb text-amber-500"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1.3.5 2.6 1.5 3.5.8.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/><path d="M12 22a2 2 0 0 0 2-2H10a2 2 0 0 0 2 2Z"/></svg>
                    <span>Daily Dose of Wisdom</span>
                </h2>
                <div class="flex items-center space-x-4 mb-4">
                    <button id="get-quote-btn" class="bg-slate-700 text-slate-200 px-6 py-3 rounded-lg font-medium shadow-md hover:bg-slate-600 transition-colors disabled:bg-slate-400">
                        Get a Quote
                    </button>
                </div>
                <!-- The quote will be displayed here -->
                <div id="quote-box" class="bg-slate-900 p-4 rounded-lg border border-slate-700 mt-4">
                    <p id="quote-text" class="text-amber-500 leading-relaxed italic text-center text-lg">"The secret to a good financial life is to find a way to make money while you sleep."</p>
                    <p id="quote-author" class="text-slate-400 mt-2 text-right"> - Unknown</p>
                </div>
            </div>

            <!-- Add Expenses Section -->
            <div class="bg-slate-800 p-6 rounded-xl shadow-md border border-slate-700">
                <h2 class="text-xl font-bold mb-4 text-slate-200">Add Expenses</h2>
                <form id="expense-form" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="expense-name" placeholder="Expense Title" class="p-3 border border-slate-700 bg-slate-900 text-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" required />
                        <input type="number" id="expense-amount" step="0.01" placeholder="Amount" class="p-3 border border-slate-700 bg-slate-900 text-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" required />
                        <input type="date" id="expense-date" class="p-3 border border-slate-700 bg-slate-900 text-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" required />
                        <select id="expense-category" class="p-3 border border-slate-700 bg-slate-900 text-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" required>
                            <option value="" disabled selected>Select a category</option>
                            <option value="Housing">Housing</option>
                            <option value="Utilities">Utilities</option>
                            <option value="Food">Food</option>
                            <option value="Transportation">Transportation</option>
                            <option value="Personal Care">Personal Care</option>
                            <option value="Healthcare">Healthcare</option>
                            <option value="Debt">Debt</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Shopping">Shopping</option>
                            <option value="Education">Education</option>
                            <option value="Other">Other</option>
                        </select>
                        <select id="expense-currency" class="p-3 border border-slate-700 bg-slate-900 text-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                            <option value="INR">INR (₹)</option>
                            <option value="USD">USD ($)</option>
                            <option value="EUR">EUR (€)</option>
                        </select>
                    </div>
                    
                    <!-- Recurring Expense Toggle -->
                    <div class="flex items-center space-x-3 mt-4">
                        <label class="text-slate-300 font-medium">Recurring Expense?</label>
                        <label class="recurring-toggle-switch">
                            <input type="checkbox" id="is-recurring">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <!-- Recurring Options (Initially Hidden) -->
                    <div id="recurring-options" class="space-y-4 mt-4 hidden">
                        <div class="flex items-center space-x-4">
                            <label for="recurrence-frequency" class="text-slate-300">Frequency:</label>
                            <select id="recurrence-frequency" class="flex-1 p-3 border border-slate-700 bg-slate-900 text-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                        
                        <!-- Weekly Days (Initially Hidden) -->
                        <div id="weekly-days-container" class="space-y-2 hidden">
                            <label class="text-slate-300">Select Day(s) of the Week:</label>
                            <div class="flex flex-wrap gap-2">
                                <label class="inline-flex items-center text-slate-300">
                                    <input type="checkbox" name="weekly-day" value="Mon" class="form-checkbox text-amber-500 rounded-lg focus:ring-0" />
                                    <span class="ml-2">Mon</span>
                                </label>
                                <label class="inline-flex items-center text-slate-300">
                                    <input type="checkbox" name="weekly-day" value="Tue" class="form-checkbox text-amber-500 rounded-lg focus:ring-0" />
                                    <span class="ml-2">Tue</span>
                                </label>
                                <label class="inline-flex items-center text-slate-300">
                                    <input type="checkbox" name="weekly-day" value="Wed" class="form-checkbox text-amber-500 rounded-lg focus:ring-0" />
                                    <span class="ml-2">Wed</span>
                                </label>
                                <label class="inline-flex items-center text-slate-300">
                                    <input type="checkbox" name="weekly-day" value="Thu" class="form-checkbox text-amber-500 rounded-lg focus:ring-0" />
                                    <span class="ml-2">Thu</span>
                                </label>
                                <label class="inline-flex items-center text-slate-300">
                                    <input type="checkbox" name="weekly-day" value="Fri" class="form-checkbox text-amber-500 rounded-lg focus:ring-0" />
                                    <span class="ml-2">Fri</span>
                                </label>
                                <label class="inline-flex items-center text-slate-300">
                                    <input type="checkbox" name="weekly-day" value="Sat" class="form-checkbox text-amber-500 rounded-lg focus:ring-0" />
                                    <span class="ml-2">Sat</span>
                                </label>
                                <label class="inline-flex items-center text-slate-300">
                                    <input type="checkbox" name="weekly-day" value="Sun" class="form-checkbox text-amber-500 rounded-lg focus:ring-0" />
                                    <span class="ml-2">Sun</span>
                                </label>
                            </div>
                        </div>

                        <!-- Monthly Day (Initially Hidden) -->
                        <div id="monthly-day-container" class="space-y-2 hidden">
                            <label for="monthly-day" class="text-slate-300">Select Day of the Month:</label>
                            <input type="number" id="monthly-day" min="1" max="31" value="1" class="w-full p-3 border border-slate-700 bg-slate-900 text-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" />
                        </div>
                    </div>

                    <div class="flex justify-center mt-6">
                        <button type="submit" class="bg-amber-500 text-slate-900 font-bold py-3 px-8 rounded-full shadow-lg hover:bg-amber-600 transition-colors transform hover:scale-105">
                            Add Expense
                        </button>
                    </div>
                </form>
            </div>

            <!-- Budget Tracking Section -->
            <div class="bg-slate-800 p-6 rounded-xl shadow-md border border-slate-700">
                <h2 class="text-xl font-bold mb-4 flex items-center space-x-2 text-slate-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-dollar-sign text-emerald-500"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                    <span>Budget Tracking</span>
                </h2>
                <div class="flex flex-col md:flex-row md:items-center space-y-4 md:space-y-0 md:space-x-4">
                    <input type="number" id="budget-input" step="100" placeholder="Enter your monthly budget" class="w-full flex-1 p-3 border border-slate-700 bg-slate-900 text-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500" />
                    <button id="set-budget-btn" class="bg-emerald-500 text-slate-900 px-6 py-3 rounded-lg font-bold shadow-md hover:bg-emerald-600 transition-colors">
                        Set Budget
                    </button>
                </div>
                <div id="budget-info" class="mt-4 p-4 bg-slate-900 rounded-lg border border-slate-700 hidden">
                    <p class="text-lg font-medium">Monthly Budget: <span id="budget-display" class="text-emerald-500 font-bold"></span></p>
                    <p class="text-lg font-medium mt-2">Remaining: <span id="remaining-budget" class="text-emerald-500 font-bold"></span></p>
                </div>
            </div>

            <!-- Expenses List and Charts Section -->
            <div class="bg-slate-800 p-6 rounded-xl shadow-md border border-slate-700">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-slate-200">Your Expenses</h2>
                    <div class="flex space-x-2">
                        <button id="export-btn" class="bg-slate-700 text-slate-200 p-2 rounded-full shadow-md hover:bg-slate-600 transition-colors" title="Export Data">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-share"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" x2="12" y1="2" y2="15"/></svg>
                        </button>
                    </div>
                </div>
                <!-- Chart and list containers -->
                <div class="mt-6 flex flex-col lg:flex-row space-y-8 lg:space-y-0 lg:space-x-8">
                    <!-- Chart Section -->
                    <div class="flex-1 bg-slate-900 p-4 rounded-lg border border-slate-700">
                        <h3 class="text-lg font-medium text-slate-200 mb-2">Expenses by Category</h3>
                        <div class="flex space-x-2 mb-4">
                            <button id="chart-type-bar" class="bg-amber-500 text-slate-900 text-sm font-medium px-4 py-2 rounded-full hover:bg-amber-600 transition-colors">Bar</button>
                            <button id="chart-type-line" class="bg-slate-700 text-slate-300 text-sm font-medium px-4 py-2 rounded-full hover:bg-slate-600 transition-colors">Line</button>
                            <button id="chart-type-pie" class="bg-slate-700 text-slate-300 text-sm font-medium px-4 py-2 rounded-full hover:bg-slate-600 transition-colors">Pie</button>
                        </div>
                        <canvas id="expense-chart" class="w-full"></canvas>
                    </div>
                    <!-- Expenses List -->
                    <div class="lg:w-1/2 bg-slate-900 p-4 rounded-lg border border-slate-700 overflow-y-auto max-h-96 custom-scrollbar">
                        <ul id="expenses-list" class="space-y-4">
                            <!-- Expense items will be inserted here by JavaScript -->
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>

    <!-- My custom Firebase setup and app logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, query, onSnapshot, addDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let app, db, auth, userId;
        let expenses = [];
        let budget = 0;
        let chartInstance;
        let chartType = 'bar'; // Default chart type

        // --- UI Element References ---
        const messageModal = document.getElementById('message-modal');
        const messageText = document.getElementById('message-text');
        const messageOkBtn = document.getElementById('message-ok-btn');
        const usernameInput = document.getElementById('username-input');
        const setUsernameBtn = document.getElementById('set-username-btn');
        const currentUsername = document.getElementById('current-username');
        const usernameDisplay = document.getElementById('username-display');
        const userIdDisplay = document.getElementById('user-id-display');
        const expenseForm = document.getElementById('expense-form');
        const expenseName = document.getElementById('expense-name');
        const expenseAmount = document.getElementById('expense-amount');
        const expenseDate = document.getElementById('expense-date');
        const expenseCategory = document.getElementById('expense-category');
        const expenseCurrency = document.getElementById('expense-currency');
        const expensesList = document.getElementById('expenses-list');
        const budgetInput = document.getElementById('budget-input');
        const setBudgetBtn = document.getElementById('set-budget-btn');
        const budgetInfo = document.getElementById('budget-info');
        const budgetDisplay = document.getElementById('budget-display');
        const remainingBudget = document.getElementById('remaining-budget');
        const isRecurringToggle = document.getElementById('is-recurring');
        const recurringOptions = document.getElementById('recurring-options');
        const recurrenceFrequency = document.getElementById('recurrence-frequency');
        const weeklyDaysContainer = document.getElementById('weekly-days-container');
        const monthlyDayContainer = document.getElementById('monthly-day-container');
        const chartTypeBarBtn = document.getElementById('chart-type-bar');
        const chartTypeLineBtn = document.getElementById('chart-type-line');
        const chartTypePieBtn = document.getElementById('chart-type-pie');
        const exportBtn = document.getElementById('export-btn');
        const exportModal = document.getElementById('export-modal');
        const exportModalCloseBtn = document.getElementById('export-modal-close-btn');
        const downloadCsvBtn = document.getElementById('download-csv-btn');
        const emailCsvBtn = document.getElementById('email-csv-btn');
        const showLogBtn = document.getElementById('show-log-btn');
        const logModal = document.getElementById('log-modal');
        const logModalCloseBtn = document.getElementById('log-modal-close-btn');
        const logEntries = document.getElementById('log-entries');
        const getQuoteBtn = document.getElementById('get-quote-btn');
        const quoteText = document.getElementById('quote-text');
        const quoteAuthor = document.getElementById('quote-author');

        // --- Quotes Data ---
        const quotes = [
            { text: "The secret to a good financial life is to find a way to make money while you sleep.", author: "Warren Buffett (paraphrased)" },
            { text: "There's no business like show business, but there's no money like my business.", author: "Drax, Guardians of the Galaxy (paraphrased)" },
            { text: "Don't spend money on things that will make you feel poor.", author: "Unknown" },
            { text: "I may not have a million dollars, but I'm rich in other ways. Like, I have a lot of debt.", author: "A very relatable person" },
            { text: "You can't buy happiness, but you can buy a plane ticket, and that's pretty close.", author: "Unknown" },
            { text: "A budget is telling your money where to go instead of wondering where it went.", author: "Dave Ramsey" },
            { text: "The first rule of finance club is, you don't talk about finance club.", author: "Tyler Durden (paraphrased)" },
            { text: "Money is only a tool. It will take you wherever you wish, but it will not replace you as the driver.", author: "Ayn Rand" },
            { text: "If you think nobody cares, try missing a couple of payments.", author: "Unknown" },
            { text: "Never spend your money before you have it.", author: "Thomas Jefferson" },
            { text: "I've been rich and I've been poor. Rich is better.", author: "Mae West" }
        ];

        // --- App Initialization & Firebase Setup ---
        const initFirebase = async () => {
            if (!firebaseConfig || Object.keys(firebaseConfig).length === 0) {
                console.error("Firebase config is missing. App cannot be initialized.");
                return;
            }
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            console.log("Firebase initialized.");

            // Sign in with custom token if available, otherwise sign in anonymously
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    console.log("User signed in with UID:", userId);
                    userIdDisplay.textContent = `User ID: ${userId}`;
                    userIdDisplay.classList.remove('hidden');

                    // Start listening for data
                    fetchUserData();
                    fetchExpenses();
                } else {
                    console.log("No user signed in. Attempting anonymous sign-in...");
                    try {
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (error) {
                        console.error("Firebase auth error:", error);
                        showMessage(`Authentication failed: ${error.message}`);
                    }
                }
            });
        };

        // --- Utility Functions ---
        const showMessage = (message) => {
            messageText.textContent = message;
            messageModal.classList.remove('hidden');
            messageModal.classList.add('flex');
        };

        messageOkBtn.addEventListener('click', () => {
            messageModal.classList.add('hidden');
        });

        const formatDate = (dateString) => {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        };

        const generateRandomQuote = () => {
            const randomIndex = Math.floor(Math.random() * quotes.length);
            const quote = quotes[randomIndex];
            quoteText.textContent = `"${quote.text}"`;
            quoteAuthor.textContent = `- ${quote.author}`;
            document.getElementById('quote-box').classList.remove('hidden');
        };

        // --- Event Listeners and Logic ---

        // Get Quote Button Logic
        getQuoteBtn.addEventListener('click', () => {
            generateRandomQuote();
        });

        // Generate a random quote on page load
        window.addEventListener('DOMContentLoaded', () => {
            generateRandomQuote();
            initFirebase();
        });

        // Username logic
        setUsernameBtn.addEventListener('click', async () => {
            const username = usernameInput.value.trim();
            if (username.length < 8 || username.length > 12) {
                showMessage("Username must be between 8 and 12 characters.");
                return;
            }

            if (userId) {
                try {
                    const userDocRef = doc(db, 'artifacts', appId, 'users', userId, 'userData', 'profile');
                    await setDoc(userDocRef, { username: username, lastUpdated: new Date() }, { merge: true });
                    usernameDisplay.textContent = username;
                    currentUsername.classList.remove('hidden');
                    showMessage("Username set successfully!");
                } catch (error) {
                    console.error("Error setting username:", error);
                    showMessage("Failed to set username. Please try again.");
                }
            } else {
                showMessage("User not authenticated. Please wait a moment and try again.");
            }
        });

        // Budget logic
        setBudgetBtn.addEventListener('click', async () => {
            const budgetAmount = parseFloat(budgetInput.value);
            if (isNaN(budgetAmount) || budgetAmount <= 0) {
                showMessage("Please enter a valid budget amount.");
                return;
            }

            if (userId) {
                try {
                    const userDocRef = doc(db, 'artifacts', appId, 'users', userId, 'userData', 'profile');
                    await setDoc(userDocRef, { budget: budgetAmount }, { merge: true });
                    showMessage("Budget set successfully!");
                } catch (error) {
                    console.error("Error setting budget:", error);
                    showMessage("Failed to set budget. Please try again.");
                }
            }
        });

        // Expense Form Logic
        expenseForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!userId) {
                showMessage("User not authenticated. Please wait a moment and try again.");
                return;
            }

            const newExpense = {
                title: expenseName.value,
                amount: parseFloat(expenseAmount.value),
                date: expenseDate.value,
                category: expenseCategory.value,
                currency: expenseCurrency.value,
                recurring: isRecurringToggle.checked,
                recurringDetails: isRecurringToggle.checked ? {
                    frequency: recurrenceFrequency.value,
                    days: recurrenceFrequency.value === 'weekly' ? Array.from(document.querySelectorAll('input[name="weekly-day"]:checked')).map(el => el.value) : [],
                    dayOfMonth: recurrenceFrequency.value === 'monthly' ? parseInt(monthlyDay.value) : null
                } : null,
                timestamp: new Date()
            };
            
            try {
                const expensesCollectionRef = collection(db, 'artifacts', appId, 'users', userId, 'expenses');
                await addDoc(expensesCollectionRef, newExpense);
                showMessage("Expense added successfully!");
                expenseForm.reset();
                isRecurringToggle.checked = false;
                recurringOptions.classList.add('hidden');
            } catch (error) {
                console.error("Error adding expense:", error);
                showMessage("Failed to add expense. Please try again.");
            }
        });
        
        // Delete Expense Logic
        const deleteExpense = async (docId) => {
            if (userId) {
                try {
                    const expenseDocRef = doc(db, 'artifacts', appId, 'users', userId, 'expenses', docId);
                    await deleteDoc(expenseDocRef);
                    showMessage("Expense deleted successfully.");
                } catch (error) {
                    console.error("Error deleting expense:", error);
                    showMessage("Failed to delete expense. Please try again.");
                }
            }
        };

        // UI toggles for recurring expenses
        isRecurringToggle.addEventListener('change', (e) => {
            if (e.target.checked) {
                recurringOptions.classList.remove('hidden');
                updateRecurringOptionsVisibility();
            } else {
                recurringOptions.classList.add('hidden');
            }
        });

        recurrenceFrequency.addEventListener('change', () => {
            updateRecurringOptionsVisibility();
        });

        function updateRecurringOptionsVisibility() {
            const frequency = recurrenceFrequency.value;
            weeklyDaysContainer.classList.add('hidden');
            monthlyDayContainer.classList.add('hidden');
            if (frequency === 'weekly') {
                weeklyDaysContainer.classList.remove('hidden');
            } else if (frequency === 'monthly') {
                monthlyDayContainer.classList.remove('hidden');
            }
        }

        // --- Data Fetching from Firestore ---
        const fetchUserData = () => {
            if (!userId) return;

            const userDocRef = doc(db, 'artifacts', appId, 'users', userId, 'userData', 'profile');
            onSnapshot(userDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    if (data.username) {
                        usernameDisplay.textContent = data.username;
                        currentUsername.classList.remove('hidden');
                    }
                    if (data.budget) {
                        budget = data.budget;
                        budgetDisplay.textContent = `${data.currency || '₹'} ${budget.toFixed(2)}`;
                        budgetInfo.classList.remove('hidden');
                        updateRemainingBudget();
                    }
                }
            }, (error) => {
                console.error("Error fetching user data:", error);
            });
        };

        const fetchExpenses = () => {
            if (!userId) return;

            const expensesCollectionRef = collection(db, 'artifacts', appId, 'users', userId, 'expenses');
            onSnapshot(expensesCollectionRef, (querySnapshot) => {
                expenses = [];
                querySnapshot.forEach((doc) => {
                    expenses.push({ id: doc.id, ...doc.data() });
                });
                renderExpensesList();
                renderCharts();
                updateRemainingBudget();
            }, (error) => {
                console.error("Error fetching expenses:", error);
            });
        };

        // --- Rendering Functions ---
        const renderExpensesList = () => {
            expensesList.innerHTML = ''; // Clear the list
            expenses.sort((a, b) => new Date(b.date) - new Date(a.date));

            expenses.forEach(expense => {
                const listItem = document.createElement('li');
                listItem.className = "flex items-center justify-between p-4 bg-slate-800 rounded-lg shadow-sm border border-slate-700";
                listItem.innerHTML = `
                    <div class="flex-1">
                        <div class="flex items-center justify-between">
                            <h4 class="text-lg font-semibold text-slate-100">${expense.title}</h4>
                            <span class="text-amber-500 font-bold">${expense.currency || '₹'} ${expense.amount.toFixed(2)}</span>
                        </div>
                        <div class="flex items-center text-sm text-slate-400 mt-1">
                            <span>${expense.category}</span>
                            <span class="mx-2">•</span>
                            <span>${formatDate(expense.date)}</span>
                        </div>
                    </div>
                    <button class="delete-expense-btn text-slate-400 hover:text-red-500 transition-colors ml-4" data-id="${expense.id}" title="Delete Expense">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                    </button>
                `;
                expensesList.appendChild(listItem);
            });

            // Add event listeners for delete buttons
            document.querySelectorAll('.delete-expense-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const docId = e.currentTarget.getAttribute('data-id');
                    deleteExpense(docId);
                });
            });
        };

        const updateRemainingBudget = () => {
            const totalExpenses = expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const remaining = budget - totalExpenses;
            remainingBudget.textContent = `${expenses[0]?.currency || '₹'} ${remaining.toFixed(2)}`;
            if (remaining < 0) {
                remainingBudget.classList.remove('text-emerald-500');
                remainingBudget.classList.add('text-red-500');
            } else {
                remainingBudget.classList.remove('text-red-500');
                remainingBudget.classList.add('text-emerald-500');
            }
        };

        const renderCharts = () => {
            const ctx = document.getElementById('expense-chart').getContext('2d');
            const categories = [...new Set(expenses.map(e => e.category))];
            const dataMap = categories.map(cat => ({
                category: cat,
                amount: expenses.filter(e => e.category === cat).reduce((sum, e) => sum + e.amount, 0)
            }));

            const dataLabels = dataMap.map(d => d.category);
            const dataValues = dataMap.map(d => d.amount);
            const backgroundColors = dataMap.map((_, i) => `hsl(${i * 30}, 80%, 60%)`);

            const chartData = {
                labels: dataLabels,
                datasets: [{
                    label: 'Expenses by Category',
                    data: dataValues,
                    backgroundColor: backgroundColors,
                    borderColor: '#1e293b',
                    borderWidth: 1
                }]
            };

            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#cbd5e1'
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: { color: '#cbd5e1' },
                        grid: { color: 'rgba(71,85,105, 0.2)' }
                    },
                    y: {
                        ticks: { color: '#cbd5e1' },
                        grid: { color: 'rgba(71,85,105, 0.2)' }
                    }
                }
            };
            
            // Adjust options for pie chart
            if (chartType === 'pie') {
                delete chartOptions.scales; // Remove scales for pie chart
            }

            if (chartInstance) {
                chartInstance.destroy(); // Destroy existing chart before creating a new one
            }

            chartInstance = new Chart(ctx, {
                type: chartType,
                data: chartData,
                options: chartOptions
            });
        };

        // --- Chart Type Buttons ---
        chartTypeBarBtn.addEventListener('click', () => {
            chartType = 'bar';
            document.querySelectorAll('#chart-type-bar, #chart-type-pie, #chart-type-line').forEach(btn => {
                if (btn.id === 'chart-type-bar') {
                    btn.classList.replace('bg-slate-700', 'bg-amber-500');
                    btn.classList.replace('text-slate-300', 'text-slate-900');
                    btn.classList.remove('hover:bg-slate-600');
                    btn.classList.add('hover:bg-amber-600');
                } else {
                    btn.classList.replace('bg-amber-500', 'bg-slate-700');
                    btn.classList.replace('text-slate-900', 'text-slate-300');
                    btn.classList.add('hover:bg-slate-600');
                    btn.classList.remove('hover:bg-amber-600');
                }
            });
            renderCharts();
        });
        chartTypeLineBtn.addEventListener('click', () => {
            chartType = 'line';
            document.querySelectorAll('#chart-type-bar, #chart-type-pie, #chart-type-line').forEach(btn => {
                if (btn.id === 'chart-type-line') {
                    btn.classList.replace('bg-slate-700', 'bg-amber-500');
                    btn.classList.replace('text-slate-300', 'text-slate-900');
                    btn.classList.remove('hover:bg-slate-600');
                    btn.classList.add('hover:bg-amber-600');
                } else {
                    btn.classList.replace('bg-amber-500', 'bg-slate-700');
                    btn.classList.replace('text-slate-900', 'text-slate-300');
                    btn.classList.add('hover:bg-slate-600');
                    btn.classList.remove('hover:bg-amber-600');
                }
            });
            renderCharts();
        });
        chartTypePieBtn.addEventListener('click', () => {
            chartType = 'pie';
            document.querySelectorAll('#chart-type-bar, #chart-type-pie, #chart-type-line').forEach(btn => {
                if (btn.id === 'chart-type-pie') {
                    btn.classList.replace('bg-slate-700', 'bg-amber-500');
                    btn.classList.replace('text-slate-300', 'text-slate-900');
                    btn.classList.remove('hover:bg-slate-600');
                    btn.classList.add('hover:bg-amber-600');
                } else {
                    btn.classList.replace('bg-amber-500', 'bg-slate-700');
                    btn.classList.replace('text-slate-900', 'text-slate-300');
                    btn.classList.add('hover:bg-slate-600');
                    btn.classList.remove('hover:bg-amber-600');
                }
            });
            renderCharts();
        });

        // --- Export functionality ---
        const downloadCSV = () => {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Title,Amount,Date,Category,Currency,Recurring\n";

            expenses.forEach(exp => {
                const row = [
                    `"${exp.title}"`,
                    exp.amount,
                    exp.date,
                    exp.category,
                    exp.currency,
                    exp.recurring ? 'Yes' : 'No'
                ].join(',');
                csvContent += row + "\n";
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `avarata-expenses-${new Date().toISOString().slice(0, 10)}.csv`);
            document.body.appendChild(link); // Required for Firefox
            link.click();
            document.body.removeChild(link);
            showMessage("Expenses downloaded as CSV!");
        };

        exportBtn.addEventListener('click', () => {
            exportModal.classList.remove('hidden');
            exportModal.classList.add('flex');
        });
        exportModalCloseBtn.addEventListener('click', () => {
            exportModal.classList.add('hidden');
        });
        downloadCsvBtn.addEventListener('click', () => {
            downloadCSV();
            exportModal.classList.add('hidden');
        });
        
        // Activity Log Modal functionality
        showLogBtn.addEventListener('click', () => {
            logModal.classList.remove('hidden');
            logModal.classList.add('flex');
        });
        logModalCloseBtn.addEventListener('click', () => {
            logModal.classList.add('hidden');
        });

        // Placeholder for logging functionality to be implemented
        // For now, this is a visual container
        // logEntries.innerHTML = `<p class="text-slate-400">Activity logging is not yet implemented.</p>`;
    </script>
</body>
</html>
```
