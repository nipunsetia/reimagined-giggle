<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Āvarta: Finance Flow</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Firebase SDKs -->
    <script type="module">
        import {
            initializeApp
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import {
            getAuth,
            signInWithCustomToken,
            signInAnonymously,
            onAuthStateChanged,
            signOut
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import {
            getFirestore,
            doc,
            getDoc,
            setDoc,
            onSnapshot,
            collection,
            addDoc,
            deleteDoc,
            updateDoc,
            getDocs,
            query,
            where,
            writeBatch
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // The following variables are provided by the canvas environment.
        // DO NOT change them.
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let userId = null;
        let expensesCollectionRef = null;
        let allExpenses = [];
        let username = null;
        let budget = 0;
        let quoteRefreshCount = 0;
        const MAX_QUOTE_REFRESHES = 5;
        let logsCollectionRef = null;
        let userSettingsDocRef = null;
        let currency = 'INR';
        let currencySymbol = '₹';
        let currentChartInstance = null;

        // Get DOM elements
        const quoteText = document.getElementById('dynamic-quote');
        const usernameDisplay = document.getElementById('username-display');
        const usernameLoginModal = document.getElementById('username-login-modal');
        const usernameLoginForm = document.getElementById('username-login-form');
        const usernameLoginInput = document.getElementById('username-login-input');
        const changeUserBtn = document.getElementById('change-user-btn');
        const deleteAccountBtn = document.getElementById('delete-account-btn');
        const expenseForm = document.getElementById('expense-form');
        const expenseNameInput = document.getElementById('expense-name');
        const expenseAmountInput = document.getElementById('expense-amount');
        const expenseCategorySelect = document.getElementById('expense-category');
        const expenseDateInput = document.getElementById('expense-date');
        const recurringCheckbox = document.getElementById('recurring-checkbox');
        const recurringToggleLabel = document.getElementById('recurring-toggle-label');
        const recurringOptionsContainer = document.getElementById('recurring-options-container');
        const weeklyOptions = document.getElementById('weekly-options');
        const monthlyOptions = document.getElementById('monthly-options');
        const expensesList = document.getElementById('expenses-list');
        const totalExpensesText = document.getElementById('total-expenses');
        const remainingBudgetText = document.getElementById('remaining-budget');
        const budgetProgress = document.getElementById('budget-progress');
        const budgetForm = document.getElementById('budget-form');
        const budgetInput = document.getElementById('budget-input');
        const recurrenceFreqRadios = document.querySelectorAll('input[name="recurrence-freq"]');
        const monthFilterSelect = document.getElementById('month-filter');
        const yearFilterSelect = document.getElementById('year-filter');
        const messageBox = document.getElementById('message-box');
        const messageTitle = document.getElementById('message-title');
        const messageText = document.getElementById('message-text');
        const closeMessageBtn = document.getElementById('close-message-btn');
        const chartCanvas = document.getElementById('main-chart-canvas');
        const chartTitle = document.getElementById('chart-title');
        const chartBtns = document.querySelectorAll('.chart-btn');
        const aiBudgetSuggestionBtn = document.getElementById('ai-budget-suggestion-btn');
        const exportJsonBtn = document.getElementById('export-json-btn');
        const exportCsvBtn = document.getElementById('export-csv-btn');
        const quoteRefreshBtn = document.getElementById('quote-refresh-btn');
        const logsList = document.getElementById('logs-list');
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const currencySelect = document.getElementById('currency-select');
        const userIdDisplay = document.getElementById('user-id-display');
        const exportListJsonBtn = document.getElementById('export-list-json-btn');
        const exportListCsvBtn = document.getElementById('export-list-csv-btn');
        const deleteConfirmModal = document.getElementById('delete-confirm-modal');
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
        const cancelDeleteBtn = document.getElementById('cancel-delete-btn');

        // AI Budget Suggestions (static array)
        const aiBudgetSuggestions = [
            "Set a daily spending limit and track it actively.",
            "Review your subscriptions and cancel any you don't use.",
            "Create a 'needs' versus 'wants' list for better spending habits.",
            "Try the 50/30/20 rule: 50% for needs, 30% for wants, 20% for savings.",
            "Automate your savings to build wealth effortlessly.",
            "Cook at home more often to save money on dining out.",
            "Use a budgeting app to categorize and understand your spending.",
            "Track your small, daily expenses; they add up quickly!",
            "Plan your meals for the week to avoid impulse grocery purchases.",
            "Compare prices before making a major purchase.",
            "Set specific financial goals, like saving for a vacation or a down payment.",
            "Review your phone and internet plans for potential savings.",
            "Negotiate your bills, such as cable or insurance, for a better rate.",
            "Start an emergency fund with at least 3-6 months of living expenses.",
            "Pay down high-interest debt, like credit card balances, first.",
            "Use cash for discretionary spending to stay within your budget.",
            "Try a no-spend challenge for a week or a month.",
            "Cut back on impulse purchases by waiting 24 hours before buying.",
            "Look for free or low-cost entertainment options.",
            "Buy second-hand items instead of new ones when possible.",
            "Refinance your mortgage or student loans if it makes financial sense.",
            "Invest in low-cost index funds for long-term growth.",
            "Open a high-yield savings account to earn more on your cash.",
            "Review your monthly statements for any fraudulent or forgotten charges.",
            "Learn to differentiate between asset and liability.",
            "Avoid lifestyle creep as your income increases.",
            "Pack your own lunch to save on daily food costs.",
            "Consider a side hustle to increase your income.",
            "Invest in yourself through education or skill-building.",
            "Understand your tax obligations and plan for them.",
            "Diversify your investments to manage risk.",
            "Practice mindful spending by thinking about each purchase.",
            "Create a debt repayment plan with a clear timeline.",
            "Build a financial calendar to stay on top of bills.",
            "Use a credit card with rewards, but pay the balance in full each month.",
            "Talk to a financial advisor for personalized guidance.",
            "Make sure your retirement savings are on track.",
            "Consider canceling unused gym memberships or subscriptions.",
            "Buy in bulk for non-perishable items to save money.",
            "Repair instead of replacing items when possible.",
            "Look for free software alternatives to paid programs.",
            "Use public transportation or carpool to save on fuel.",
            "Find cheaper alternatives for your coffee habit.",
            "Always have a budget, no matter your income level.",
            "Don't let emotions guide your financial decisions.",
            "Invest in a good quality, reusable water bottle and coffee mug.",
            "Plan for annual and semi-annual expenses in your monthly budget.",
            "Make sure you have adequate insurance coverage.",
            "Consider a 'sinking fund' for specific future expenses.",
            "Review your utility bills for ways to save energy.",
            "Take advantage of employer-sponsored retirement plans.",
            "Teach yourself about personal finance through books or podcasts.",
            "Use coupons or discount codes whenever you shop.",
            "Sell items you no longer need to earn extra cash.",
            "Set up a password manager for your financial accounts.",
            "Check your credit report regularly for errors.",
            "Review your banking fees and switch to a fee-free bank if possible.",
            "Keep track of your net worth to monitor your progress.",
            "Don't compare your financial journey to others.",
            "Focus on long-term wealth building, not quick wins.",
            "Build good credit by paying bills on time.",
            "Automate bill payments to avoid late fees.",
            "Set aside money for a 'fun' budget to prevent burnout.",
            "Understand the power of compound interest.",
            "Review your investment fees; they can eat into your returns.",
            "Avoid carrying a balance on credit cards.",
            "Save for big purchases in advance to avoid debt.",
            "Create a budget that is realistic and flexible.",
            "Track your savings rate and try to increase it over time.",
            "Invest in your health to prevent future medical costs.",
            "Avoid taking out personal loans unless absolutely necessary.",
            "Create a meal plan to reduce food waste.",
            "Be aware of financial scams and fraud.",
            "Set aside a small amount each week for a 'play' budget.",
            "Make sure your beneficiaries are up-to-date on all accounts.",
            "Keep a record of your financial goals.",
            "Look for loyalty programs and rewards at places you frequent.",
            "Understand the difference between tax-deductible and non-deductible expenses.",
            "Consider creating a will or living trust.",
            "Try to live below your means.",
            "Review your monthly bank statements carefully.",
            "Start a 'side hustle' to create another income stream.",
            "Use price tracking apps for online shopping.",
            "Always look for ways to cut down on expenses.",
            "Review your insurance policies to ensure they meet your needs.",
            "Set a savings goal for your next big vacation.",
            "Practice saying 'no' to social events that are outside your budget.",
            "Keep an eye on market trends, but don't panic sell.",
            "Educate yourself on different investment vehicles.",
            "Save a portion of every raise or bonus you receive.",
            "Avoid get-rich-quick schemes.",
            "Create a financial binder with all your important documents.",
            "Don't be afraid to ask for a raise at work.",
            "Track your net worth and celebrate your progress.",
            "Set a 'financial check-in' date each month.",
            "Ensure your financial goals are specific, measurable, and achievable.",
            "Consider the environmental impact of your purchases.",
            "Keep your money in a separate account for savings.",
            "Avoid paying for things you can get for free, like banking services.",
            "Make sure you're getting the best interest rate on your loans.",
            "Review your credit card statements for any errors.",
            "Save for your retirement early to take advantage of compounding.",
            "Understand the fees associated with your investments."
        ];


        // Utility Functions
        const showMessage = (title, message, isError = false) => {
            messageBox.classList.remove('hidden');
            messageTitle.textContent = title;
            messageText.textContent = message;
            if (isError) {
                messageBox.classList.remove('bg-slate-800');
                messageBox.classList.add('bg-red-800');
            } else {
                messageBox.classList.remove('bg-red-800');
                messageBox.classList.add('bg-slate-800');
            }
        };

        const hideMessage = () => {
            messageBox.classList.add('hidden');
        };

        const showModal = (modalElement) => {
            modalElement.classList.remove('hidden');
        };

        const hideModal = (modalElement) => {
            modalElement.classList.add('hidden');
        };

        const createOrUpdateChart = (type, labels, data, options, title) => {
            if (currentChartInstance) {
                currentChartInstance.destroy();
            }
            if (chartCanvas) {
                const ctx = chartCanvas.getContext('2d');
                currentChartInstance = new Chart(ctx, {
                    type,
                    data: {
                        labels,
                        datasets: [{
                            data
                        }]
                    },
                    options
                });
                chartTitle.textContent = title;
            }
        };

        const renderChart = (chartType, expenses) => {
            const filteredExpenses = expenses.filter(expense => {
                const date = new Date(expense.timestamp);
                const expenseMonth = date.getMonth().toString();
                const expenseYear = date.getFullYear().toString();
                const selectedMonth = monthFilterSelect.value;
                const selectedYear = yearFilterSelect.value;
                return (selectedMonth === 'all' || expenseMonth === selectedMonth) &&
                    (selectedYear === 'all' || expenseYear === selectedYear);
            });

            if (chartType === 'category') {
                const categoryMap = filteredExpenses.reduce((acc, expense) => {
                    const {
                        category,
                        amount
                    } = expense;
                    acc[category] = (acc[category] || 0) + amount;
                    return acc;
                }, {});
                const categories = Object.keys(categoryMap);
                const amounts = Object.values(categoryMap);
                createOrUpdateChart('pie', categories, amounts, {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#e2e8f0'
                            }
                        },
                        title: {
                            display: false
                        }
                    }
                }, 'Category Breakdown');
            } else if (chartType === 'monthly') {
                const monthlyMap = filteredExpenses.reduce((acc, expense) => {
                    const date = new Date(expense.timestamp);
                    const month = date.toLocaleString('default', {
                        month: 'short'
                    }) + ' ' + date.getFullYear();
                    acc[month] = (acc[month] || 0) + expense.amount;
                    return acc;
                }, {});
                const months = Object.keys(monthlyMap);
                const monthlyAmounts = Object.values(monthlyMap);
                createOrUpdateChart('bar', months, monthlyAmounts, {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255,255,255,0.1)'
                            },
                            ticks: {
                                color: '#e2e8f0'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255,255,255,0.1)'
                            },
                            ticks: {
                                color: '#e2e8f0'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: false
                        }
                    }
                }, 'Monthly Trends');
            } else if (chartType === 'daily') {
                const dailyMap = filteredExpenses.reduce((acc, expense) => {
                    const date = new Date(expense.timestamp).toLocaleDateString();
                    acc[date] = (acc[date] || 0) + expense.amount;
                    return acc;
                }, {});
                const dates = Object.keys(dailyMap).sort((a, b) => new Date(a) - new Date(b));
                const dailyAmounts = dates.map(date => dailyMap[date]);
                createOrUpdateChart('line', dates, dailyAmounts, {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255,255,255,0.1)'
                            },
                            ticks: {
                                color: '#e2e8f0'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255,255,255,0.1)'
                            },
                            ticks: {
                                color: '#e2e8f0'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: false
                        }
                    }
                }, 'Daily Flow');
            }
        };

        const showTab = (tabId) => {
            tabContents.forEach(content => content.classList.add('hidden'));
            tabBtns.forEach(btn => btn.classList.remove('bg-amber-500', 'text-slate-900', 'hover:bg-amber-400'));
            tabBtns.forEach(btn => btn.classList.add('bg-slate-700', 'text-slate-300', 'hover:bg-slate-600'));
            document.getElementById(tabId).classList.remove('hidden');
            const clickedBtn = document.querySelector(`[data-tab-id="${tabId}"]`);
            clickedBtn.classList.remove('bg-slate-700', 'text-slate-300', 'hover:bg-slate-600');
            clickedBtn.classList.add('bg-amber-500', 'text-slate-900', 'hover:bg-amber-400');
        };

        const setAndSaveUsername = async (newUsername) => {
            if (!userId) {
                showMessage("Error", "User not authenticated. Please try refreshing the page.", true);
                return;
            }

            try {
                // Save the username to the user's private settings document
                const userSettingsDocRef = doc(db, `artifacts/${appId}/users/${userId}/profile/settings`);
                await setDoc(userSettingsDocRef, {
                    username: newUsername,
                    currency: 'INR'
                }, {
                    merge: true
                });

                username = newUsername;
                usernameDisplay.textContent = username;
                userIdDisplay.textContent = userId;
                hideModal(usernameLoginModal);
                showMessage("Success", `Welcome, ${username}! Your data is now linked to this account.`);
                addLog(`Username set to: ${username}`);
            } catch (error) {
                console.error("Error saving username:", error);
                showMessage("Error", "Failed to set username. Please try again.", true);
            }
        };

        const deleteAccount = async () => {
            if (!userId) {
                showMessage("Error", "No user to delete.", true);
                return;
            }

            try {
                // Delete user's expenses
                const expensesCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/expenses`);
                const expensesQuery = query(expensesCollectionRef);
                const expensesSnapshot = await getDocs(expensesQuery);
                const batch = writeBatch(db);
                expensesSnapshot.forEach((doc) => {
                    batch.delete(doc.ref);
                });
                await batch.commit();

                // Delete user's logs
                const logsCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/logs`);
                const logsQuery = query(logsCollectionRef);
                const logsSnapshot = await getDocs(logsQuery);
                const logsBatch = writeBatch(db);
                logsSnapshot.forEach((doc) => {
                    logsBatch.delete(doc.ref);
                });
                await logsBatch.commit();
                
                // Delete user's profile and settings documents
                await deleteDoc(doc(db, `artifacts/${appId}/users/${userId}/profile/budget`));
                await deleteDoc(doc(db, `artifacts/${appId}/users/${userId}/profile/settings`));

                showMessage("Success", `Account for "${username}" has been permanently deleted.`);
                await signOut(auth);
                resetUI();
            } catch (error) {
                console.error("Error deleting account:", error);
                showMessage("Error", "Failed to delete account. Please try again.", true);
            }
        };

        const resetUI = () => {
            // Clear all UI elements and reset global variables
            userId = null;
            username = null;
            allExpenses = [];
            budget = 0;
            usernameDisplay.textContent = 'Guest';
            userIdDisplay.textContent = '';
            expensesList.innerHTML = '';
            logsList.innerHTML = '';
            renderBudgetUI(0);
            if (currentChartInstance) {
                currentChartInstance.destroy();
            }
            showModal(usernameLoginModal);
        };

        const saveBudget = async (e) => {
            e.preventDefault();
            const newBudget = parseFloat(budgetInput.value);
            if (!userId || newBudget <= 0) {
                showMessage("Validation Error", "Please enter a valid budget amount.", true);
                return;
            }
            const budgetDocRef = doc(db, `artifacts/${appId}/users/${userId}/profile/budget`);
            try {
                await setDoc(budgetDocRef, {
                    amount: newBudget,
                    lastUpdated: Date.now()
                });
                budget = newBudget; // Update local budget variable
                showMessage("Success", `Budget set to ${currencySymbol}${newBudget.toFixed(2)}.`);
                addLog(`Budget set to ${currencySymbol}${newBudget.toFixed(2)}`);
            } catch (error) {
                console.error("Error saving budget: ", error);
                showMessage("Error", "Failed to save budget. Please try again.", true);
            }
        };

        const renderBudgetUI = (totalExpenses) => {
            const remaining = budget - totalExpenses;
            totalExpensesText.textContent = `${currencySymbol}${totalExpenses.toFixed(2)}`;
            remainingBudgetText.textContent = `${currencySymbol}${remaining.toFixed(2)}`;

            remainingBudgetText.classList.remove('text-green-500', 'text-red-500');
            remainingBudgetText.classList.add(remaining >= 0 ? 'text-green-500' : 'text-red-500');

            if (budget > 0) {
                const percentage = Math.min((totalExpenses / budget) * 100, 100);
                budgetProgress.style.width = `${percentage}%`;

                budgetProgress.classList.remove('bg-amber-500', 'bg-red-500');
                if (percentage >= 100) {
                    budgetProgress.classList.add('bg-red-500');
                } else {
                    budgetProgress.classList.add('bg-amber-500');
                }
            } else {
                budgetProgress.style.width = '0%';
            }
        };

        const changeUser = async () => {
            await signOut(auth);
            resetUI();
            showMessage("Info", "Session cleared. Please refresh the page to start a new session.");
        };

        const addLog = async (action) => {
            if (!userId) return;
            const logData = {
                action,
                timestamp: Date.now()
            };
            try {
                if (logsCollectionRef) {
                    await addDoc(logsCollectionRef, logData);
                }
            } catch (error) {
                console.error("Error adding log:", error);
            }
        };

        const renderLogs = (logs) => {
            logsList.innerHTML = '';
            if (logs.length === 0) {
                logsList.innerHTML = `<li class="text-center text-slate-400">No logs found.</li>`;
            } else {
                logs.sort((a, b) => b.timestamp - a.timestamp);
                logs.forEach(log => {
                    const li = document.createElement('li');
                    li.className = 'bg-slate-700 p-3 rounded-lg shadow-md mb-2';
                    const timestamp = new Date(log.timestamp).toLocaleString();
                    li.innerHTML = `
                <p class="text-slate-300">${log.action}</p>
                <p class="text-xs text-slate-500 mt-1">${timestamp}</p>
            `;
                    logsList.appendChild(li);
                });
            }
        };

        // API Call for Quotes
        const getDynamicQuote = async () => {
            const staticQuotes = [{
                text: "The only way to get a good idea is to get a lot of ideas.",
                source: "Linus Pauling"
            }, {
                text: "Don't tell me where your priorities are. Show me where you spend your money and I'll tell you what they are.",
                source: "James W. Frick"
            }, {
                text: "The stock market is a device for transferring money from the impatient to the patient.",
                source: "Warren Buffett"
            }, {
                text: "Do not save what is left after spending; instead, spend what is left after saving.",
                source: "Warren Buffett"
            }, {
                text: "The journey of a thousand miles begins with a single step.",
                source: "Lao Tzu"
            }];
            const quotePrompt = "Give a short, inspiring quote on a topic from: movies, music, culture, poetry, art, science, stoicism, finance, facts, or puns. Provide a brief one-sentence quote.";

            if (quoteRefreshCount < MAX_QUOTE_REFRESHES) {
                try {
                    const chatHistory = [{
                        role: "user",
                        parts: [{
                            text: quotePrompt
                        }]
                    }];
                    const payload = {
                        contents: chatHistory
                    };
                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                    let response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });

                    let result = await response.json();

                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts) {
                        const text = result.candidates[0].content.parts[0].text;
                        quoteText.textContent = text.replace(/["“”„‟‘’‚‛‹›«»「」『』【】《》〈〉《》「」『』】]/g, '');
                        quoteRefreshCount++;
                        addLog("Quote refreshed.");
                    } else {
                        const randomQuote = staticQuotes[Math.floor(Math.random() * staticQuotes.length)];
                        quoteText.textContent = `"${randomQuote.text}" - ${randomQuote.source}`;
                    }
                } catch (error) {
                    console.error("Error fetching quote:", error);
                    const randomQuote = staticQuotes[Math.floor(Math.random() * staticQuotes.length)];
                    quoteText.textContent = `"${randomQuote.text}" - ${randomQuote.source}`;
                }
            } else {
                showMessage("Limit Reached", "You have reached the maximum number of quote refreshes for this session.", true);
            }
        };

        const renderExpenses = (expenses) => {
            expensesList.innerHTML = '';
            if (expenses.length === 0) {
                expensesList.innerHTML = `<li class="text-center text-slate-400">No expenses found.</li>`;
                return;
            }

            const filteredExpenses = expenses.filter(expense => {
                const date = new Date(expense.timestamp);
                const expenseMonth = date.getMonth().toString();
                const expenseYear = date.getFullYear().toString();
                const selectedMonth = monthFilterSelect.value;
                const selectedYear = yearFilterSelect.value;
                return (selectedMonth === 'all' || expenseMonth === selectedMonth) &&
                    (selectedYear === 'all' || expenseYear === selectedYear);
            });

            let totalExpenses = 0;
            if (filteredExpenses.length === 0) {
                expensesList.innerHTML = `<li class="text-center text-slate-400">No expenses for the selected filter.</li>`;
            } else {
                filteredExpenses.forEach(expense => {
                    const li = document.createElement('li');
                    li.className = 'bg-slate-700 p-4 rounded-lg shadow-md flex justify-between items-center';
                    li.dataset.id = expense.id;
                    const date = new Date(expense.timestamp);
                    const formattedDate = date.toLocaleDateString();
                    li.innerHTML = `
                <div>
                    <h4 class="text-lg font-semibold text-amber-300">${expense.name}</h4>
                    <p class="text-slate-400 text-sm">Category: ${expense.category}</p>
                    <p class="text-slate-500 text-xs mt-1">Date: ${formattedDate}</p>
                </div>
                <div class="flex items-center">
                    <span class="text-amber-500 text-xl font-bold mr-4">${currencySymbol}${expense.amount.toFixed(2)}</span>
                    <button class="edit-expense-btn text-slate-400 hover:text-amber-500 transition-colors duration-200 mr-2" data-id="${expense.id}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                        </svg>
                    </button>
                    <button class="delete-expense-btn text-slate-400 hover:text-red-500 transition-colors duration-200" data-id="${expense.id}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            `;
                    expensesList.appendChild(li);
                    totalExpenses += expense.amount;
                });
            }

            renderBudgetUI(totalExpenses);
            renderChart('category', filteredExpenses);
        };

        const setupFirestoreListeners = async (uid) => {
            userId = uid;
            expensesCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/expenses`);
            logsCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/logs`);
            userSettingsDocRef = doc(db, `artifacts/${appId}/users/${userId}/profile/settings`);

            // Listen for changes in user settings
            const settingsDoc = await getDoc(userSettingsDocRef);
            if (settingsDoc.exists()) {
                const settings = settingsDoc.data();
                username = settings.username || 'Guest';
                if (settings.currency) {
                    currency = settings.currency;
                    currencySymbol = settings.currency === 'USD' ? '$' : '₹';
                    currencySelect.value = currency;
                }
                hideModal(usernameLoginModal);
            } else {
                showModal(usernameLoginModal);
            }
            usernameDisplay.textContent = username;
            userIdDisplay.textContent = userId;

            // Listen for changes in expenses
            onSnapshot(expensesCollectionRef, (snapshot) => {
                const changes = snapshot.docChanges();
                changes.forEach(change => {
                    const expense = {
                        id: change.doc.id,
                        ...change.doc.data()
                    };
                    if (change.type === "added") {
                        allExpenses.push(expense);
                    }
                    if (change.type === "modified") {
                        const index = allExpenses.findIndex(e => e.id === expense.id);
                        if (index !== -1) {
                            allExpenses[index] = expense;
                        }
                    }
                    if (change.type === "removed") {
                        allExpenses = allExpenses.filter(e => e.id !== expense.id);
                    }
                });
                renderExpenses(allExpenses);
            });

            // Listen for changes in budget
            onSnapshot(doc(db, `artifacts/${appId}/users/${userId}/profile/budget`), (docSnap) => {
                if (docSnap.exists()) {
                    budget = docSnap.data().amount;
                    renderBudgetUI(allExpenses.reduce((sum, e) => sum + e.amount, 0));
                }
            });

            // Listen for changes in logs
            onSnapshot(query(logsCollectionRef), (snapshot) => {
                const logs = snapshot.docs.map(doc => doc.data());
                renderLogs(logs);
            });

            getDynamicQuote();
        };

        const saveCurrency = async (newCurrency) => {
            if (!userId) return;
            try {
                await setDoc(userSettingsDocRef, { currency: newCurrency }, { merge: true });
                showMessage("Success", `Currency set to ${newCurrency}.`);
            } catch (error) {
                console.error("Error saving currency:", error);
                showMessage("Error", "Failed to save currency.", true);
            }
        };

        // Event Listeners
        window.onload = async () => {
            // Check for authentication
            if (initialAuthToken) {
                await signInWithCustomToken(auth, initialAuthToken);
            } else {
                await signInAnonymously(auth);
            }
        };

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                console.log("User is authenticated with UID:", user.uid);
                // Set up listeners for the new user
                await setupFirestoreListeners(user.uid);
            } else {
                console.log("User is signed out.");
                resetUI();
            }
        });


        // Handle username login form submission
        usernameLoginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const newUsername = usernameLoginInput.value.trim();
            if (newUsername) {
                await setAndSaveUsername(newUsername);
            } else {
                showMessage("Validation Error", "Please enter a username.", true);
            }
        });

        // Other event listeners (unchanged from your original code)
        expenseForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const expense = {
                name: expenseNameInput.value,
                amount: parseFloat(expenseAmountInput.value),
                category: expenseCategorySelect.value,
                timestamp: expenseDateInput.value ? new Date(expenseDateInput.value).getTime() : Date.now(),
                isRecurring: recurringCheckbox.checked,
                recurrence: recurringCheckbox.checked ? document.querySelector('input[name="recurrence-freq"]:checked').value : null,
            };
            if (!expense.name || isNaN(expense.amount) || expense.amount <= 0) {
                showMessage("Validation Error", "Please fill out all fields correctly.", true);
                return;
            }
            try {
                if (expensesCollectionRef) {
                    await addDoc(expensesCollectionRef, expense);
                    expenseForm.reset();
                    showMessage("Success", `Expense "${expense.name}" added successfully.`);
                    addLog(`Added expense: ${expense.name} (${currencySymbol}${expense.amount})`);
                } else {
                    showMessage("Error", "User data not loaded. Please log in with a username.", true);
                }
            } catch (error) {
                console.error("Error adding document: ", error);
                showMessage("Error", "Failed to add expense. Please try again.", true);
            }
        });

        budgetForm.addEventListener('submit', saveBudget);
        changeUserBtn.addEventListener('click', changeUser);

        deleteAccountBtn.addEventListener('click', () => {
            showModal(deleteConfirmModal);
        });

        confirmDeleteBtn.addEventListener('click', deleteAccount);
        cancelDeleteBtn.addEventListener('click', () => {
            hideModal(deleteConfirmModal);
        });

        // Event listener for recurring checkbox
        recurringCheckbox.addEventListener('change', (e) => {
            if (e.target.checked) {
                recurringOptionsContainer.classList.remove('hidden');
            } else {
                recurringOptionsContainer.classList.add('hidden');
            }
        });

        expensesList.addEventListener('click', async (e) => {
            const targetBtn = e.target.closest('.delete-expense-btn');
            if (targetBtn && expensesCollectionRef) {
                const expenseId = targetBtn.dataset.id;
                try {
                    await deleteDoc(doc(expensesCollectionRef, expenseId));
                    showMessage("Success", "Expense deleted successfully.");
                    addLog(`Deleted expense with ID: ${expenseId}`);
                } catch (error) {
                    console.error("Error deleting expense: ", error);
                    showMessage("Error", "Failed to delete expense. Please try again.", true);
                }
            }
        });

        closeMessageBtn.addEventListener('click', hideMessage);

        chartBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                chartBtns.forEach(b => b.classList.remove('bg-amber-500', 'text-slate-900', 'hover:bg-amber-400'));
                chartBtns.forEach(b => b.classList.add('bg-slate-700', 'text-slate-300', 'hover:bg-slate-600'));
                e.target.classList.remove('bg-slate-700', 'text-slate-300', 'hover:bg-slate-600');
                e.target.classList.add('bg-amber-500', 'text-slate-900', 'hover:bg-amber-400');
                const chartType = e.target.dataset.chart;
                renderChart(chartType, allExpenses);
            });
        });

        document.getElementById('ai-budget-suggestion-btn').addEventListener('click', () => {
            const randomIndex = Math.floor(Math.random() * aiBudgetSuggestions.length);
            const suggestion = aiBudgetSuggestions[randomIndex];
            showMessage("AI Suggestion", suggestion);
            addLog("Requested AI budget suggestion.");
        });

        exportJsonBtn.addEventListener('click', () => {
            const data = JSON.stringify(allExpenses, null, 2);
            const blob = new Blob([data], {
                type: 'application/json'
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'expenses.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            addLog("Exported expenses to JSON.");
            showMessage("Success", "Expenses exported as JSON.");
        });

        exportCsvBtn.addEventListener('click', () => {
            const headers = ["id", "name", "amount", "category", "timestamp"];
            const csv = [
                headers.join(','),
                ...allExpenses.map(expense => headers.map(header => JSON.stringify(expense[header])).join(','))
            ].join('\n');
            const blob = new Blob([csv], {
                type: 'text/csv'
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'expenses.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            addLog("Exported expenses to CSV.");
            showMessage("Success", "Expenses exported as CSV.");
        });

        quoteRefreshBtn.addEventListener('click', getDynamicQuote);

        tabBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                showTab(e.target.dataset.tabId);
            });
        });

        currencySelect.addEventListener('change', (e) => {
            currency = e.target.value;
            currencySymbol = currency === 'USD' ? '$' : '₹';
            saveCurrency(currency);
            renderExpenses(allExpenses);
        });

        monthFilterSelect.addEventListener('change', () => {
            renderExpenses(allExpenses);
        });

        yearFilterSelect.addEventListener('change', () => {
            renderExpenses(allExpenses);
        });

        // Set initial tab
        showTab('dashboard-tab');
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }

        .scroll-container {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }

        .scroll-container::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body class="bg-slate-900 text-slate-300 flex justify-center items-start min-h-screen p-4 sm:p-8">

    <!-- Username Login Modal -->
    <div id="username-login-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-75">
        <div class="bg-slate-800 p-8 rounded-lg shadow-xl w-full max-w-md">
            <h2 class="text-2xl font-bold text-slate-300 mb-4 text-center">Welcome to Āvarta</h2>
            <p class="text-slate-400 mb-6 text-center">Please enter a unique username to personalize your account.</p>
            <form id="username-login-form">
                <input type="text" id="username-login-input" placeholder="Enter unique username" class="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 text-slate-300 focus:outline-none focus:border-amber-500 mb-4" required>
                <button type="submit" class="w-full bg-amber-500 text-slate-900 font-semibold py-3 rounded-lg shadow-md transition-colors duration-200 hover:bg-amber-400">
                    Set Username
                </button>
            </form>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-container w-full max-w-6xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-white mb-2">Āvarta</h1>
            <p class="text-amber-500 font-medium tracking-wide">Finance Flow</p>
            <div class="mt-4 p-4 bg-slate-800 rounded-lg shadow-lg border border-slate-700">
                <blockquote class="text-sm italic text-slate-400" id="dynamic-quote">
                    "Loading an inspiring quote..."
                </blockquote>
                <button id="quote-refresh-btn" class="mt-2 text-xs text-amber-500 hover:text-amber-400 transition-colors duration-200">
                    Refresh Quote
                </button>
            </div>
        </header>

        <!-- Message Box -->
        <div id="message-box" class="fixed top-4 right-4 z-50 hidden bg-slate-800 text-slate-300 p-4 rounded-lg shadow-xl border border-slate-700">
            <h3 id="message-title" class="font-bold mb-1"></h3>
            <p id="message-text" class="text-sm"></p>
            <button id="close-message-btn" class="absolute top-2 right-2 text-slate-400 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Sidebar / Controls -->
            <div class="lg:col-span-1 space-y-8">
                <!-- User Profile and Account Management -->
                <div class="bg-slate-800 p-6 rounded-lg shadow-xl border border-slate-700">
                    <h3 class="text-xl font-bold text-slate-300 mb-2">My Profile</h3>
                    <div class="flex items-center justify-between mb-4">
                        <p class="text-slate-400">
                            Username: <span id="username-display" class="font-semibold text-amber-500">Guest</span>
                        </p>
                        <button id="change-user-btn" class="px-3 py-1 text-xs bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600 transition-colors duration-200">
                            Change User
                        </button>
                    </div>
                    <div class="flex items-center justify-between mb-4">
                        <p class="text-slate-400">
                            User ID: <span id="user-id-display" class="font-semibold text-slate-500"></span>
                        </p>
                    </div>
                    <div class="flex items-center justify-between">
                        <p class="text-slate-400">
                            Currency:
                            <select id="currency-select" class="bg-slate-700 text-slate-300 p-1 rounded-lg">
                                <option value="INR">INR</option>
                                <option value="USD">USD</option>
                            </select>
                        </p>
                        <button id="delete-account-btn" class="px-3 py-1 text-xs bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors duration-200">
                            Delete Account
                        </button>
                    </div>
                </div>

                <!-- Delete Confirmation Modal -->
                <div id="delete-confirm-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-75">
                    <div class="bg-slate-800 p-8 rounded-lg shadow-xl w-full max-w-sm text-center">
                        <h2 class="text-2xl font-bold text-slate-300 mb-4">Confirm Deletion</h2>
                        <p class="text-slate-400 mb-6">Are you sure you want to permanently delete your account and all associated data? This action cannot be undone.</p>
                        <div class="flex justify-center space-x-4">
                            <button id="cancel-delete-btn" class="px-4 py-2 bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600 transition-colors duration-200">
                                Cancel
                            </button>
                            <button id="confirm-delete-btn" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors duration-200">
                                Delete Permanently
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Budget Section -->
                <div class="bg-slate-800 p-6 rounded-lg shadow-xl border border-slate-700">
                    <h3 class="text-xl font-bold text-slate-300 mb-4">Budget</h3>
                    <div class="flex justify-between items-center mb-2">
                        <p class="text-slate-400">Total Expenses:</p>
                        <span id="total-expenses" class="text-lg font-bold text-amber-500">₹0.00</span>
                    </div>
                    <div class="flex justify-between items-center mb-4">
                        <p class="text-slate-400">Remaining Budget:</p>
                        <span id="remaining-budget" class="text-lg font-bold text-green-500">₹0.00</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-2.5 mb-4">
                        <div id="budget-progress" class="bg-amber-500 h-2.5 rounded-full transition-all duration-300" style="width: 0%;"></div>
                    </div>
                    <form id="budget-form" class="flex gap-2">
                        <input type="number" id="budget-input" placeholder="Set Monthly Budget" class="flex-1 p-2 rounded-lg bg-slate-700 border border-slate-600 text-slate-300 focus:outline-none focus:border-amber-500" required>
                        <button type="submit" class="bg-amber-500 text-slate-900 px-4 py-2 rounded-lg shadow-md transition-colors duration-200 hover:bg-amber-400">
                            Set
                        </button>
                    </form>
                    <button id="ai-budget-suggestion-btn" class="w-full mt-4 px-4 py-2 bg-slate-700 text-amber-300 font-medium rounded-lg shadow-md transition-colors duration-200 hover:bg-slate-600">
                        Get AI Budget Suggestion
                    </button>
                </div>

                <!-- Expense Form -->
                <div class="bg-slate-800 p-6 rounded-lg shadow-xl border border-slate-700">
                    <h3 class="text-xl font-bold text-slate-300 mb-4">Add New Expense</h3>
                    <form id="expense-form" class="space-y-4">
                        <input type="text" id="expense-name" placeholder="Expense Name" class="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 text-slate-300 focus:outline-none focus:border-amber-500" required>
                        <input type="number" id="expense-amount" placeholder="Amount" class="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 text-slate-300 focus:outline-none focus:border-amber-500" required>
                        <select id="expense-category" class="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 text-slate-300 focus:outline-none focus:border-amber-500">
                            <option value="Groceries">Groceries</option>
                            <option value="Utilities">Utilities</option>
                            <option value="Rent">Rent</option>
                            <option value="Transport">Transport</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Shopping">Shopping</option>
                            <option value="Other">Other</option>
                        </select>
                        <input type="date" id="expense-date" class="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 text-slate-300 focus:outline-none focus:border-amber-500">

                        <div class="flex items-center justify-between">
                            <label for="recurring-checkbox" class="text-slate-300">Recurring Expense?</label>
                            <label for="recurring-checkbox" class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="recurring-checkbox" class="sr-only peer">
                                <div id="recurring-toggle-label" class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-amber-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-amber-500"></div>
                            </label>
                        </div>
                        <div id="recurring-options-container" class="hidden mt-4 bg-slate-700 p-4 rounded-lg">
                            <p class="text-slate-400 mb-2">Recurrence Frequency</p>
                            <div class="flex items-center space-x-4">
                                <div>
                                    <input type="radio" id="weekly" name="recurrence-freq" value="weekly" class="hidden peer" checked>
                                    <label for="weekly" class="block w-full cursor-pointer px-4 py-2 bg-slate-600 text-slate-300 rounded-lg hover:bg-slate-500 transition-colors duration-200 peer-checked:bg-amber-500 peer-checked:text-slate-900">Weekly</label>
                                </div>
                                <div>
                                    <input type="radio" id="monthly" name="recurrence-freq" value="monthly" class="hidden peer">
                                    <label for="monthly" class="block w-full cursor-pointer px-4 py-2 bg-slate-600 text-slate-300 rounded-lg hover:bg-slate-500 transition-colors duration-200 peer-checked:bg-amber-500 peer-checked:text-slate-900">Monthly</label>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-amber-500 text-slate-900 font-semibold py-3 rounded-lg shadow-md transition-colors duration-200 hover:bg-amber-400">
                            Add Expense
                        </button>
                    </form>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Tab Navigation -->
                <div class="bg-slate-800 p-2 rounded-lg shadow-xl flex border border-slate-700">
                    <button data-tab-id="dashboard-tab" class="tab-btn flex-1 px-4 py-2 rounded-lg font-medium shadow-md transition-colors duration-200 bg-amber-500 text-slate-900 hover:bg-amber-400 mr-2">Dashboard</button>
                    <button data-tab-id="expenses-tab" class="tab-btn flex-1 px-4 py-2 rounded-lg font-medium shadow-md transition-colors duration-200 bg-slate-700 hover:bg-slate-600 text-slate-300 mr-2">Expenses</button>
                    <button data-tab-id="logs-tab" class="tab-btn flex-1 px-4 py-2 rounded-lg font-medium shadow-md transition-colors duration-200 bg-slate-700 hover:bg-slate-600 text-slate-300">Logs</button>
                </div>

                <!-- Dashboard Tab -->
                <div id="dashboard-tab" class="tab-content">
                    <div class="bg-slate-800 p-6 rounded-lg shadow-xl border border-slate-700">
                        <h3 id="chart-title" class="text-xl font-bold text-slate-300 mb-4">Category Breakdown</h3>
                        <div class="flex justify-center mb-4 space-x-2">
                            <button data-chart="category" class="chart-btn px-4 py-2 rounded-lg font-medium shadow-md transition-colors duration-200 bg-amber-500 hover:bg-amber-400 text-slate-900">Categories</button>
                            <button data-chart="monthly" class="chart-btn px-4 py-2 rounded-lg font-medium shadow-md transition-colors duration-200 bg-slate-700 hover:bg-slate-600 text-slate-300">Monthly</button>
                            <button data-chart="daily" class="chart-btn px-4 py-2 rounded-lg font-medium shadow-md transition-colors duration-200 bg-slate-700 hover:bg-slate-600 text-slate-300">Daily</button>
                        </div>
                        <div class="chart-container h-80">
                            <canvas id="main-chart-canvas"></canvas>
                        </div>
                        <div class="flex justify-end mt-4">
                            <button id="export-json-btn" class="px-4 py-2 bg-slate-700 text-slate-300 font-medium rounded-lg shadow-md transition-colors duration-200 hover:bg-slate-600 mr-2">Export JSON</button>
                            <button id="export-csv-btn" class="px-4 py-2 bg-slate-700 text-slate-300 font-medium rounded-lg shadow-md transition-colors duration-200 hover:bg-slate-600">Export CSV</button>
                        </div>
                    </div>
                </div>

                <!-- Expenses Tab -->
                <div id="expenses-tab" class="tab-content hidden">
                    <div class="bg-slate-800 p-6 rounded-lg shadow-xl border border-slate-700">
                        <h3 class="text-xl font-bold text-slate-300 mb-4">Expense List</h3>
                        <div class="flex justify-between items-center mb-4">
                            <div class="flex space-x-2">
                                <select id="month-filter" class="bg-slate-700 text-slate-300 p-2 rounded-lg">
                                    <option value="all">All Months</option>
                                    <option value="0">January</option>
                                    <option value="1">February</option>
                                    <option value="2">March</option>
                                    <option value="3">April</option>
                                    <option value="4">May</option>
                                    <option value="5">June</option>
                                    <option value="6">July</option>
                                    <option value="7">August</option>
                                    <option value="8">September</option>
                                    <option value="9">October</option>
                                    <option value="10">November</option>
                                    <option value="11">December</option>
                                </select>
                                <select id="year-filter" class="bg-slate-700 text-slate-300 p-2 rounded-lg">
                                    <option value="all">All Years</option>
                                    <script>
                                        const currentYear = new Date().getFullYear();
                                        for (let i = 0; i < 5; i++) {
                                            document.write(`<option value="${currentYear - i}">${currentYear - i}</option>`);
                                        }
                                    </script>
                                </select>
                            </div>
                            <div>
                                <button id="export-list-json-btn" class="px-3 py-1 bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600 transition-colors duration-200 mr-2">JSON</button>
                                <button id="export-list-csv-btn" class="px-3 py-1 bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600 transition-colors duration-200">CSV</button>
                            </div>
                        </div>
                        <div class="h-96 overflow-y-auto scroll-container">
                            <ul id="expenses-list" class="space-y-4">
                                <!-- Expenses will be dynamically added here -->
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Logs Section -->
                <div id="logs-tab" class="tab-content hidden">
                    <div class="bg-slate-800 p-6 rounded-lg shadow-xl border border-slate-700">
                        <h3 class="text-xl font-bold text-slate-300 mb-4">User Logs</h3>
                        <p class="text-xs text-slate-500 mb-4">User ID: <span id="user-id-display"></span></p>
                        <div class="h-96 overflow-y-auto scroll-container">
                            <ul id="logs-list" class="space-y-2">
                                <!-- Logs will be dynamically added here -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>

</html>
